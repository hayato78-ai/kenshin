# CDmedical å¥è¨ºã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆæ›¸
## ã‚·ãƒ¼ãƒˆãƒ»ã‚«ãƒ©ãƒ è©³ç´°å®šç¾©ï¼ˆiD-Heart IIæº–æ‹ ï¼‰

> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0
> **ä½œæˆæ—¥**: 2025-12-20

---

## 1. ã‚·ãƒ¼ãƒˆä¸€è¦§

### ãƒã‚¹ã‚¿ç³»

| ã‚·ãƒ¼ãƒˆå | èª¬æ˜ | ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ç›®å®‰ |
|----------|------|---------------|
| M_æ¤œæŸ»é …ç›® | æ¤œæŸ»é …ç›®å®šç¾©ãƒ»åˆ¤å®šåŸºæº– | 200-500 |
| M_æ¤œæŸ»æ‰€è¦‹ | æ‰€è¦‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | 300-1000 |
| M_ã‚³ãƒ¼ã‚¹ | å¥è¨ºã‚³ãƒ¼ã‚¹ | 10-50 |
| M_ã‚³ãƒ¼ã‚¹é …ç›® | ã‚³ãƒ¼ã‚¹-æ¤œæŸ»é …ç›®é–¢é€£ | 500-2000 |
| M_åˆ¤å®šé …ç›® | éƒ¨ä½åˆ¥åˆ¤å®šé …ç›® | 20-50 |
| M_å›£ä½“ | ä¼æ¥­ãƒ»å›£ä½“ | 50-500 |
| M_ä¿é™ºè€… | ä¿é™ºè€… | 10-100 |

### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç³»

| ã‚·ãƒ¼ãƒˆå | èª¬æ˜ | ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ç›®å®‰ |
|----------|------|---------------|
| T_å—è¨ºè€… | å—è¨ºè€…åŸºæœ¬æƒ…å ± | 1000-50000 |
| T_å—è¨ºè¨˜éŒ² | å—è¨ºã”ã¨ã®æƒ…å ± | 5000-100000 |
| T_æ¤œæŸ»çµæœ | æ¤œæŸ»çµæœï¼ˆç¸¦æŒã¡ï¼‰ | 100000-1000000 |
| T_æ‰€è¦‹ | æ‰€è¦‹ãƒ‡ãƒ¼ã‚¿ | 10000-100000 |
| T_åˆ¤å®š | åˆ¤å®šçµæœ | 50000-500000 |
| T_é€²æ— | é€²æ—ç®¡ç† | 5000-100000 |

---

## 2. M_æ¤œæŸ»é …ç›® è©³ç´°

### ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆä¸»è¦ã‚«ãƒ©ãƒ ï¼‰

```
A: item_code        - é …ç›®ã‚³ãƒ¼ãƒ‰ (PK) ä¾‹: 011001
B: jlac10_code      - JLAC10ã‚³ãƒ¼ãƒ‰
C: item_name        - é …ç›®å ä¾‹: èº«é•·
D: item_name_kana   - ã‚«ãƒŠ
E: category         - åŒºåˆ† (èº«ä½“æƒ…å ±/æ¤œä½“æ¤œæŸ»/ç”»åƒè¨ºæ–­)
F: sub_category     - å°åˆ†é¡ (èº«ä½“è¨ˆæ¸¬/è„‚è³ª/è¡€æ¶²ä¸€èˆ¬...)
G: data_type        - ãƒ‡ãƒ¼ã‚¿å‹ (numeric/text/select)
H: decimal_places   - å°æ•°æ¡æ•°
I: unit             - å˜ä½ (cm, kg, mg/dl...)
J-K: valid_min/max  - æœ‰åŠ¹ç¯„å›²
L-M: std_male/female - å¸³ç¥¨åŸºæº–å€¤è¡¨è¨˜
N-X: criteria_*_m   - ç”·æ€§åˆ¤å®šåŸºæº– (Fä½ã€œFé«˜)
Y-AI: criteria_*_f  - å¥³æ€§åˆ¤å®šåŸºæº– (Fä½ã€œFé«˜)
AJ: default_value   - åˆæœŸå€¤
AK: finding_ref     - æ‰€è¦‹å‚ç…§åˆæœŸå€¤
AL-AO: price_*      - ã‚ªãƒ—ã‚·ãƒ§ãƒ³å˜ä¾¡
AP-AQ: lab_code     - æ¤œæŸ»ä¼šç¤¾ã‚³ãƒ¼ãƒ‰
AR: display_order   - è¡¨ç¤ºé †
AS: notes           - å‚™è€ƒ
AT: is_active       - æœ‰åŠ¹ãƒ•ãƒ©ã‚°
```

### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

| item_code | item_name | category | unit | std_male |
|-----------|-----------|----------|------|----------|
| 011001 | èº«é•· | èº«ä½“æƒ…å ± | cm | |
| 011002 | ä½“é‡ | èº«ä½“æƒ…å ± | kg | |
| 011025 | BMI | èº«ä½“æƒ…å ± | | 25æœªæº€ |
| 011014 | è…¹å›² | èº«ä½“æƒ…å ± | cm | 85æœªæº€ |
| 011005 | è¡€åœ§(æœ€é«˜) | èº«ä½“æƒ…å ± | mmHg | 130æœªæº€ |
| 021018 | ç·ã‚³ãƒ¬ã‚¹ãƒ†ãƒ­ãƒ¼ãƒ« | æ¤œä½“æ¤œæŸ» | mg/dl | 150ã€œ219 |
| 021022 | LDL-C | æ¤œä½“æ¤œæŸ» | mg/dl | 120æœªæº€ |
| 021020 | HDL-C | æ¤œä½“æ¤œæŸ» | mg/dl | 40ä»¥ä¸Š |
| 021037 | ç©ºè…¹æ™‚è¡€ç³– | æ¤œä½“æ¤œæŸ» | mg/dl | 100æœªæº€ |
| 012003 | å¿ƒé›»å›³ | ç”»åƒè¨ºæ–­ | | |
| 012012 | èƒ¸éƒ¨Xç·š | ç”»åƒè¨ºæ–­ | | |
| 050000 | eGFR | æ¤œä½“æ¤œæŸ» | | 60ä»¥ä¸Š |

---

## 3. M_æ¤œæŸ»æ‰€è¦‹ è©³ç´°

### ã‚«ãƒ©ãƒ å®šç¾©

```
A: finding_code      - æ‰€è¦‹ã‚³ãƒ¼ãƒ‰ (PK)
B: finding_name      - æ‰€è¦‹å
C: default_judgment  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåˆ¤å®š
D: exam_item_refs    - ç´ã¥ãæ¤œæŸ»é …ç›®
E: is_history        - æ—¢å¾€æ­´ãƒ•ãƒ©ã‚°
F: notes             - å‚™è€ƒ
G: display_order     - è¡¨ç¤ºé †
H: is_active         - æœ‰åŠ¹ãƒ•ãƒ©ã‚°
```

### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆiD-Heartå‚ç…§ï¼‰

| code | name | judgment | notes |
|------|------|----------|-------|
| 0001 | ç•°å¸¸ãªã— | A | |
| 0002 | ç•°å¸¸ã‚ã‚Š | C | |
| 0003 | æœªæå‡º | | |
| 0005 | é™³æ—§æ€§ç‚ç—‡æ€§å¤‰åŒ– | B | |
| 0006 | é«˜è¡€åœ§ | | æ—¢å¾€æ­´ |
| 0007 | å¿ƒè‡“ç—… | | æ—¢å¾€æ­´ |
| 0116 | STä¸Šæ˜‡ | C | |
| 0117 | STä¸‹é™ | C | |
| 0118 | ä½é›»ä½ | B | |
| 0121 | å³å®¤è‚¥å¤§ | C | |
| 0122 | å·¦å®¤è‚¥å¤§ | C | |

---

## 4. T_æ¤œæŸ»çµæœ è©³ç´°

### ã‚«ãƒ©ãƒ å®šç¾©

```
A: result_id         - çµæœID (PK)
B: visit_id          - å—è¨ºID (FK)
C: item_code         - æ¤œæŸ»é …ç›®ã‚³ãƒ¼ãƒ‰ (FK)
D: result_value      - çµæœå€¤
E: result_text       - çµæœæ–‡å­—ï¼ˆå®šæ€§ï¼‰
F: judgment          - åˆ¤å®š
G: judgment_auto     - è‡ªå‹•åˆ¤å®š
H: finding_codes     - æ‰€è¦‹ã‚³ãƒ¼ãƒ‰
I: finding_text      - æ‰€è¦‹è‡ªç”±è¨˜è¿°
J: prev_value        - å‰å›å€¤
K: prev_prev_value   - å‰ã€…å›å€¤
L: is_abnormal       - ç•°å¸¸ãƒ•ãƒ©ã‚°
M: notes             - å‚™è€ƒ
N: created_at        - ä½œæˆæ—¥æ™‚
O: updated_at        - æ›´æ–°æ—¥æ™‚
```

### ãƒ‡ãƒ¼ã‚¿ä¾‹

| visit_id | item_code | result_value | judgment |
|----------|-----------|--------------|----------|
| 20251217-001 | 011001 | 167.7 | * |
| 20251217-001 | 011002 | 66.1 | * |
| 20251217-001 | 011025 | 23.5 | A |
| 20251217-001 | 011005 | 114 | A |
| 20251217-001 | 021022 | 142 | C |

---

## 5. T_é€²æ— è©³ç´°

### ã‚«ãƒ©ãƒ å®šç¾©

```
A: progress_id       - é€²æ—ID (PK)
B: visit_id          - å—è¨ºID (FK)
C: pre_form          - äº‹å‰å¸³ç¥¨ (å®Œäº†/é€”ä¸­/æœª)
D: reception         - å—ä»˜
E: day_form          - å½“æ—¥å¸³ç¥¨
F: questionnaire     - å•è¨ºçµæœ
G: physical          - èº«ä½“æƒ…å ±
H: lab_test          - æ¤œä½“æ¤œæŸ»
I: imaging           - ç”»åƒè¨ºæ–­
J: specific_health   - ç‰¹å®šå¥è¨º
K: judgment          - åˆ¤å®šé …ç›®
L: findings          - æ‰€è¦‹æ–‡ç« 
M: report            - å ±å‘Šæ›¸
N: billing_org       - è«‹æ±‚å…ˆè«‹æ±‚
O: billing_person    - å€‹äººè«‹æ±‚
P: payment           - å€‹äººå…¥é‡‘
Q: updated_at        - æ›´æ–°æ—¥æ™‚
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤

| å€¤ | è¡¨ç¤º | èª¬æ˜ |
|----|------|------|
| å®Œäº† | ğŸ’š | å‡¦ç†å®Œäº† |
| é€”ä¸­ | ğŸ’› | å‡¦ç†ä¸­ |
| æœª | â¤ï¸ | æœªå‡¦ç† |
| å¯¾è±¡å¤– | â¬œ | å¯¾è±¡å¤– |

---

## 6. æ—¢å­˜GASã‚³ãƒ¼ãƒ‰ã¨ã®å¯¾å¿œ

### portalApi.js å¯¾å¿œ

```javascript
// æ—¢å­˜ PATIENT_COL â†’ æ–°æ§‹é€ 
const PATIENT_COL = {
  PATIENT_ID: 0,   // Aåˆ—: P-00001å½¢å¼
  NAME: 1,         // Båˆ—: æ°å
  KANA: 2,         // Cåˆ—: ã‚«ãƒŠ
  BIRTHDATE: 3,    // Dåˆ—: ç”Ÿå¹´æœˆæ—¥
  GENDER: 4,       // Eåˆ—: æ€§åˆ¥
  // ...
};

// æ—¢å­˜ VISIT_COL â†’ æ–°æ§‹é€ 
const VISIT_COL = {
  VISIT_ID: 0,     // Aåˆ—: 20251217-001å½¢å¼
  PATIENT_ID: 1,   // Båˆ—: å—è¨ºè€…ID (FK)
  VISIT_DATE: 2,   // Cåˆ—: å—è¨ºæ—¥
  // ...
};
```

### Config.js ã‚·ãƒ¼ãƒˆåå¯¾å¿œ

```javascript
const DB_CONFIG = {
  SHEETS: {
    // ãƒã‚¹ã‚¿
    EXAM_ITEM: 'M_æ¤œæŸ»é …ç›®',
    FINDING: 'M_æ¤œæŸ»æ‰€è¦‹',
    COURSE: 'M_ã‚³ãƒ¼ã‚¹',
    ORG: 'M_å›£ä½“',
    
    // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
    PATIENT: 'T_å—è¨ºè€…',
    VISIT: 'T_å—è¨ºè¨˜éŒ²',
    RESULT: 'T_æ¤œæŸ»çµæœ',
    PROGRESS: 'T_é€²æ—'
  }
};
```

---

## 7. åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

### æ•°å€¤åˆ¤å®š

```javascript
function autoJudge(value, gender, criteria) {
  const c = gender === 'ç”·æ€§' ? criteria.male : criteria.female;
  
  if (value >= c.f_low && value < c.e_low) return 'F';
  if (value >= c.e_low && value < c.d_low) return 'E';
  if (value >= c.d_low && value < c.c_low) return 'D';
  if (value >= c.c_low && value < c.b_low) return 'C';
  if (value >= c.b_low && value <= c.a_high) return 'B';
  if (value >= c.a_low && value <= c.a_high) return 'A';
  // é«˜å€¤å´ã‚‚åŒæ§˜
  return '*'; // åˆ¤å®šä¸å¯
}
```

### éƒ¨ä½åˆ¥åˆ¤å®š

```javascript
function getAreaJudgment(results, judmentItem) {
  // é–¢é€£ã™ã‚‹æ¤œæŸ»é …ç›®ã®åˆ¤å®šã‚’é›†è¨ˆ
  const judgments = judmentItem.related_items
    .map(code => results[code]?.judgment)
    .filter(j => j && j !== '*');
  
  // æœ€ã‚‚æ‚ªã„åˆ¤å®šã‚’æ¡ç”¨
  const priority = ['F', 'E', 'D', 'C', 'B', 'A'];
  return judgments.sort((a, b) => 
    priority.indexOf(a) - priority.indexOf(b)
  )[0] || '*';
}
```

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | Ver | å†…å®¹ |
|------|-----|------|
| 2025-12-20 | 2.0 | åˆç‰ˆï¼ˆiD-Heartåˆ†æã«åŸºã¥ãï¼‰|
