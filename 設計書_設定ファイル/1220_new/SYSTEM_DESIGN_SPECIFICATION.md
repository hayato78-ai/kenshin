# CDmedical 健診システム 統合設計書
## iD-Heart II 機能分析に基づくWebポータルシステム設計

> **バージョン**: 2.0
> **作成日**: 2025-12-20
> **ステータス**: 設計完了・実装予定

---

## 1. エグゼクティブサマリー

### 1.1 プロジェクト目標

iD-Heart II（既存のオンプレミス健診システム）のUI/UX・機能を参考に、GAS（Google Apps Script）+ Google Sheetsベースの**Webポータルシステム**を構築する。

### 1.2 優先実装機能（フェーズ1）

| 優先度 | 機能 | iD-Heart参照画面 | 既存GASコード活用 |
|--------|------|------------------|-------------------|
| ★★★ | 受診者登録・検索 | 受診者情報検索 | patientManager.js, CRUD.js |
| ★★★ | 結果入力 | 受診結果入力（身体情報/検体検査） | portalApi.js, judgmentEngine.js |
| ★★★ | 所見入力（テンプレート） | 所見文章、画像所見入力 | findingsGenerator.js |
| ★★☆ | 結果出力（Excel/PDF） | 帳票印刷、一覧表 | reportExporter.js, excelExporter.js |
| ★★☆ | 一覧表示・出力 | 進捗一覧、健診結果一覧 | billingManager.js |
| ★☆☆ | 帳票出力（企業/院内） | 結果報告書、定期健康診断報告書 | templateManager.js |

---

## 2. iD-Heart II 画面構造分析

### 2.1 メニュー階層構造

```
iD-Heart II メインメニュー
├── 窓口業務
│   ├── 予約受付
│   ├── 一括予約受付
│   ├── 受診者情報取込
│   ├── 予定表印刷
│   ├── 受診者属性登録
│   ├── 受診者分類マスタ登録
│   ├── 受診者属性管理
│   └── 受診者分類マスタ管理
│
├── 健診業務 ★優先
│   ├── 進捗一覧
│   ├── 受診結果入力 ★
│   ├── 結果一覧入力
│   ├── 検査結果取込
│   ├── 一括自動判定
│   ├── 通過状況一覧
│   ├── 通過入力
│   └── 画像所見入力 ★
│
├── 帳票出力 ★優先
│   ├── 帳票印刷 ★
│   ├── ラベル印刷
│   ├── 健診結果一覧表印刷 ★
│   ├── 定期健康診断報告書印刷
│   ├── 人間ドック成績報告書印刷
│   └── 特定健診受診者判定一覧表印刷
│
├── 契約・団体管理
│   ├── 契約情報登録/管理
│   ├── 保険者マスタ登録/管理
│   ├── 代表者マスタ登録/管理
│   ├── 団体マスタ登録/管理
│   └── 請求先マスタ登録/管理
│
├── 請求業務
│   ├── 個人請求書発行
│   ├── 団体請求書発行
│   ├── 会計名簿印刷
│   ├── 売上集計表印刷
│   ├── 入金入力
│   └── 請求先別元帳印刷
│
├── データ出力
│   ├── 特定健診XML出力
│   ├── 受診結果Excel出力 ★
│   ├── 要精密検査一覧印刷
│   ├── 検査項目別異常者一覧表印刷
│   └── 受診者集計表印刷
│
├── 環境設定
│   ├── システム管理設定
│   ├── 業務管理設定
│   ├── メニュー設定
│   ├── 権限管理設定
│   └── ...（多数）
│
├── マスタ登録
│   ├── 検査項目マスタ登録 ★
│   ├── 検査所見マスタ登録 ★
│   ├── 判定項目マスタ登録
│   ├── コースマスタ登録
│   └── ...（27項目）
│
└── マスタ管理
    ├── 検査項目マスタ管理 ★
    ├── 検査所見マスタ管理 ★
    └── ...（16項目）
```

### 2.2 画面遷移パターン

#### パターンA: 検索→一覧→詳細（CRUD系）

```
[検索条件入力] → [一覧表示] → [詳細/編集画面]
                      ↓
              [バルク操作（印刷/出力）]

例: 受診者情報検索 → 受診者一覧 → 受診結果入力
```

#### パターンB: マスタ参照ポップアップ

```
[入力画面] → 🔍ボタン → [マスタ検索ポップアップ]
                              ↓
                        [選択→自動入力]

例: 画像所見入力 → 検査所見マスタ参照 → 所見選択
```

#### パターンC: タブ切替（カテゴリ別入力）

```
[受診結果入力画面]
  ├── [問診結果] タブ
  ├── [身体情報] タブ ★
  ├── [検体検査] タブ ★
  ├── [画像診断] タブ ★
  ├── [特定健診] タブ
  ├── [判定項目] タブ ★
  └── [所見文章] タブ ★
```

---

## 3. データ構造設計

### 3.1 コアエンティティ関係図

```
┌─────────────────────────────────────────────────────────────┐
│                      【マスタデータ】                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐      ┌─────────────┐     ┌─────────────┐  │
│  │ 検査項目     │      │ 検査所見     │     │ 判定基準     │  │
│  │ マスタ       │←────│ マスタ       │     │ マスタ       │  │
│  │ (M_EXAM)    │ 1:N  │ (M_FINDING) │     │ (M_CRITERIA)│  │
│  └─────────────┘      └─────────────┘     └─────────────┘  │
│         ↑ 1:N                                     ↑        │
│         │                                         │        │
│  ┌─────────────┐      ┌─────────────┐             │        │
│  │ コース       │────→│ コース項目   │─────────────┘        │
│  │ マスタ       │ 1:N │ 関連        │                      │
│  │ (M_COURSE)  │      │ (M_COURSE_  │                      │
│  └─────────────┘      │  EXAM)      │                      │
│         ↑             └─────────────┘                      │
│         │                                                  │
└─────────┼──────────────────────────────────────────────────┘
          │
┌─────────┼──────────────────────────────────────────────────┐
│         │            【トランザクションデータ】              │
├─────────┼──────────────────────────────────────────────────┤
│         │                                                  │
│  ┌─────────────┐      ┌─────────────┐     ┌─────────────┐  │
│  │ 団体        │      │ 受診者       │     │ 受診記録     │  │
│  │ (T_ORG)    │─────→│ (T_PATIENT) │────→│ (T_VISIT)   │  │
│  └─────────────┘ 1:N  └─────────────┘ 1:N └─────────────┘  │
│         ↑                    ↑                   │         │
│         │                    │                   ↓ 1:N     │
│  ┌─────────────┐             │           ┌─────────────┐  │
│  │ 保険者       │             │           │ 検査結果     │  │
│  │ (T_INSURER) │             │           │ (T_RESULT)  │  │
│  └─────────────┘             │           └─────────────┘  │
│                              │                   │         │
│                       ┌──────┴──────┐           ↓ 1:N     │
│                       │ 請求情報     │    ┌─────────────┐  │
│                       │ (T_BILLING) │    │ 所見記録     │  │
│                       └─────────────┘    │ (T_FINDING) │  │
│                                          └─────────────┘  │
└────────────────────────────────────────────────────────────┘
```

### 3.2 シート定義（Google Sheets）

#### マスタ系シート

| シート名 | 説明 | 主キー | 備考 |
|----------|------|--------|------|
| `M_検査項目` | 検査項目マスタ | 項目コード | 身体/検体/画像診断 区分 |
| `M_検査所見` | 所見テンプレート | 所見コード | 検査項目に紐づく |
| `M_判定基準` | 判定基準値 | 項目+性別+年齢 | A〜F判定 |
| `M_コース` | 健診コースマスタ | コースコード | |
| `M_コース項目` | コース-検査項目関連 | コース+項目 | |
| `M_団体` | 企業/団体マスタ | 団体コード | |
| `M_保険者` | 保険者マスタ | 保険者番号 | |

#### トランザクション系シート

| シート名 | 説明 | 主キー | 備考 |
|----------|------|--------|------|
| `T_受診者` | 受診者マスタ | 受診者ID (P-00001) | 個人基本情報 |
| `T_受診記録` | 受診記録 | 受診ID (YYYYMMDD-NNN) | 受診ごとの情報 |
| `T_身体測定` | 身体測定結果 | 受診ID | 身長/体重/血圧等 |
| `T_検体検査` | 検体検査結果 | 受診ID | 血液/尿等 |
| `T_画像診断` | 画像診断結果 | 受診ID + 項目 | 心電図/X線等 |
| `T_所見` | 所見データ | 受診ID + 項目 | 自由記述/テンプレート |
| `T_判定` | 判定結果 | 受診ID + 判定項目 | 総合/部位別判定 |
| `T_請求` | 請求情報 | 請求ID | |

### 3.3 検査項目マスタ詳細設計

iD-Heartの検査項目マスタ登録画面より抽出:

```javascript
// M_検査項目 カラム定義
const EXAM_ITEM_COLUMNS = {
  ITEM_CODE: 0,       // 検査項目コード (例: 011001)
  JLAC10_CODE: 1,     // JLAC10コード
  ITEM_NAME: 2,       // 検査項目名 (例: 身長)
  ITEM_KANA: 3,       // カナ
  INPUT_TYPE: 4,      // 入力区分 (身体情報/検体検査/画像診断)
  DATA_TYPE: 5,       // データ型 (数値/文字)
  DECIMAL_PLACES: 6,  // 小数桁数
  UNIT: 7,            // 単位 (cm, kg, mmHg等)
  VALID_MIN: 8,       // 有効範囲下限
  VALID_MAX: 9,       // 有効範囲上限
  // 判定基準（性別別）
  CRITERIA_MALE: {
    F_LOW: 10, E_LOW: 11, D_LOW: 12, C_LOW: 13, 
    B_LOW: 14, A: 15, B_HIGH: 16, C_HIGH: 17, 
    D_HIGH: 18, E_HIGH: 19, F_HIGH: 20
  },
  CRITERIA_FEMALE: {
    F_LOW: 21, E_LOW: 22, D_LOW: 23, C_LOW: 24,
    B_LOW: 25, A: 26, B_HIGH: 27, C_HIGH: 28,
    D_HIGH: 29, E_HIGH: 30, F_HIGH: 31
  },
  DISPLAY_STD_MALE: 32,   // 帳票表記基準値（男性）
  DISPLAY_STD_FEMALE: 33, // 帳票表記基準値（女性）
  INITIAL_VALUE: 34,      // 初期値
  FINDING_REF: 35,        // 検査所見参照初期値
  ADD_PRICE: 36,          // 追加オプション単価
  ADD_PRICE_TAX: 37,      // 消費税
  DEL_PRICE: 38,          // 削除オプション単価
  DEL_PRICE_TAX: 39,      // 消費税
  LAB_COMPANY_CODE: 40,   // 検査会社依頼コード
  LAB_RESULT_CODE: 41,    // 検査結果取込コード
  NOTES: 42,              // 備考
  DISPLAY_ORDER: 43,      // 表示順
  IS_ACTIVE: 44           // 有効フラグ
};
```

### 3.4 検査所見マスタ詳細設計

```javascript
// M_検査所見 カラム定義
const FINDING_COLUMNS = {
  FINDING_CODE: 0,    // 所見コード (0001〜)
  FINDING_NAME: 1,    // 所見名 (例: 異常なし, ST上昇)
  DEFAULT_JUDGMENT: 2, // デフォルト判定 (A〜F)
  NOTES: 3,           // 備考
  EXAM_ITEM_REF: 4,   // 紐づく検査項目（複数可）
  IS_ACTIVE: 5        // 有効フラグ
};

// 所見マスタサンプルデータ（iD-Heart参照）
const FINDING_SAMPLES = [
  { code: '0001', name: '異常なし', judgment: 'A' },
  { code: '0002', name: '異常あり', judgment: 'C' },
  { code: '0003', name: '未提出', judgment: '' },
  { code: '0005', name: '陳旧性炎症性変化', judgment: 'B' },
  { code: '0006', name: '高血圧', judgment: 'C', notes: '既往歴' },
  { code: '0116', name: 'ST上昇', judgment: 'C' },
  { code: '0117', name: 'ST下降', judgment: 'C' },
  // ... 多数の所見テンプレート
];
```

---

## 4. 画面設計（UI/UX仕様）

### 4.1 メインポータル構成

```
┌─────────────────────────────────────────────────────────────┐
│ 🏥 CDmedical 健診結果管理システム     [ユーザー名] [ログアウト]│
├─────────────────────────────────────────────────────────────┤
│ [🏠ホーム][👤受診者][📝結果入力][📊帳票][🏢組織][⚙️設定]    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                      │   │
│  │              メインコンテンツエリア                   │   │
│  │                                                      │   │
│  │                                                      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ [F1:ヘルプ] [F3:参照] [F4:表示] [F5:登録] [F9:クリア] [F12:戻る]│
└─────────────────────────────────────────────────────────────┘
```

### 4.2 受診者検索画面（SCR-SRCH-001）

```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 受診者情報検索                                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 受診日   [2025/12/01] 〜 [2025/12/20]   特定健診 □対象      │
│ 受診時間 [  :  ] 〜 [  :  ]             受診券整理番号 [    ]│
│ 患者ID   [00249707] 🔍                                      │
│ 氏名・カナ [                          ]                     │
│ 生年月日  [    /  /  ] 〜 [    歳]   性別 [▼全て]          │
│ 受付区分  □仮予約 □予約 ☑受付                             │
│                                                             │
│ 団体    [      ] 🔍 [                                    ] │
│ 団体支店 [      ] 🔍 [                                    ] │
│ 団体所属 [      ] 🔍 [                                    ] │
│ 保険者   [      ] 🔍 [                                    ] │
│ コース   [      ] 🔍 [                                    ] │
│ 検索文字 [                                                ] │
│                                                             │
│                                             [F4: 表示]      │
├─────────────────────────────────────────────────────────────┤
│ │受診日   │受診時間│受診コード│患者ID │氏名    │フリガナ │...│
│ ├─────────┼────────┼──────────┼───────┼────────┼─────────┤
│ │2025/12/17│        │001-0567 │00249707│柿本 悟志│カキモト │...│
│ │2025/12/17│        │001-0569 │00250886│山田 雄太│ヤマダ   │...│
│ │...                                                        │
├─────────────────────────────────────────────────────────────┤
│ [F1] [F2] [F3:参照] [F4:表示] [F5:選択] [F9:クリア] [F12:戻る]│
└─────────────────────────────────────────────────────────────┘
```

### 4.3 受診結果入力画面（SCR-INPUT-001）

```
┌─────────────────────────────────────────────────────────────┐
│ ❤️ 受診結果入力                                              │
├─────────────────────────────────────────────────────────────┤
│ 受診日時 [2025/12/17▼] [  :  ]  受診コード [001-0567] 🔍    │
│ 患者ID   [00249707] 🔍          コース [会社健診2        ]   │
│ 受診者カナ [カキモト サトシ]     保険者 [              ]     │
│ 受診者名   [柿本 悟志    ]       団体   [個人            ]   │
│ 生年月日   [平成04年09月18日]   年齢 [33歳] 性別 [男性]      │
├─────────────────────────────────────────────────────────────┤
│ [問診結果][身体情報][検体検査][画像診断][特定健診][判定項目][所見文章]│
│ ┌──────────────────────────┬──────────────────────────────┐ │
│ │       検査項目            │    結果 │判定│  所見        │ │
│ ├──────────────────────────┼─────────┼────┼──────────────┤ │
│ │ 011001 身長              │  167.7  │  * │              │ │
│ │ 011002 体重              │   66.1  │  * │              │ │
│ │ 011026 体脂肪率          │         │    │              │ │
│ │ 011014 腹囲              │   88.2  │  * │              │ │
│ │ 011003 標準体重          │   61.9  │  * │              │ │
│ │ 011025 BMI               │   23.5  │  A │              │ │
│ │ 011015 視力 裸眼 右      │         │    │              │ │
│ │ 011016 視力 裸眼 左      │         │    │              │ │
│ │ 011017 視力 矯正 右      │    0.9  │  A │              │ │
│ │ 011018 視力 矯正 左      │    1.2  │  A │              │ │
│ │ 012021 聴力右 1000       │ 異常なし │  A │              │ │
│ │ 012022 聴力左 1000       │ 異常なし │  A │              │ │
│ │ 011005 血圧 1回目(最高)  │    114  │  A │              │ │
│ │ 011006 血圧 1回目(最低)  │     70  │  A │              │ │
│ │ ...                      │         │    │              │ │
│ └──────────────────────────┴─────────┴────┴──────────────┘ │
│ ┌────────────────────────────────────────────────────────┐ │
│ │ [経過観察] コレステロール高値                           │ │
│ └────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ [F1:入力切替][F2:自動判定][F3:参照][F4:所見入力][F5:登録]   │
│ [F6:登録&次へ] [F8:判定クリア] [F9:クリア] [F12:終了]       │
└─────────────────────────────────────────────────────────────┘
```

### 4.4 所見入力画面（テンプレート機能）（SCR-FIND-001）

```
┌─────────────────────────────────────────────────────────────┐
│ 📝 画像所見入力                                              │
├─────────────────────────────────────────────────────────────┤
│ 受診日  [2025/12/17▼]  検査項目 [012012] 🔍 [胸部単純X線]   │
│ 患者ID  [00249707] 🔍 [柿本 悟志]  H04/09/18  33歳  男性     │
├─────────────────────────────────────────────────────────────┤
│  受診者 ─────────┐ ○ × − ████████▼ 初期  検査所見 [ ]🔍  │
│ 001-0567 柿本悟志 │                                         │
│ 001-0569 山田雄太郎│      判定 [A]     A: 異常なし          │
│ 001-0572 山本隼也 │                   B: 軽度異常          │
│                   │  ┌───────────┐    C: 要経過観察        │
│                   │  │   [胸部X線 │    D: 要治療           │
│                   │  │    画像]   │    E: 要精検           │
│                   │  └───────────┘    F: 治療中            │
│                   │                                         │
│                   │  [                               ]      │
│                   │  異常なし                               │
│                   │                                         │
│                   │  判定医設定                             │
│                   │  [    ] 🔍 [                     ]      │
├───────────────────┴─────────────────────────────────────────┤
│        ┌─ 検査所見マスタ参照 ──────────────────────────────┐│
│        │ 検索文字 [                                      ] ││
│        │ │コード│ 検査所見          │ 備考              │ ││
│        │ ├──────┼───────────────────┼───────────────────┤ ││
│        │ │ 0001 │ 異常なし          │                   │ ││
│        │ │ 0002 │ 異常あり          │                   │ ││
│        │ │ 0003 │ 未提出            │                   │ ││
│        │ │ 0006 │ 高血圧            │ 既往歴            │ ││
│        │ │ 0007 │ 心臓病            │ 既往歴            │ ││
│        │ │ ...  │                   │                   │ ││
│        │ [F1:新規][F2:修正][F4:表示][F5:選択][F9:クリア]    ││
│        └────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│ [F3:参照] [F5:登録] [F9:クリア] [F12:終了]                   │
└─────────────────────────────────────────────────────────────┘
```

### 4.5 帳票印刷画面（SCR-REPORT-001）

```
┌─────────────────────────────────────────────────────────────┐
│ 🖨️ 帳票印刷                                                  │
├─────────────────────────────────────────────────────────────┤
│ 受診日  [2025/12/01▼] 〜 [2025/12/20▼]  受診時間 [  ] 〜 [  ]│
│ コース  [      ] 🔍 [                                    ] │
│ 団体    [      ] 🔍 [                                    ] │
│ 団体支店 [      ] 🔍 [                                    ] │
│ 団体所属 [      ] 🔍 [                                    ] │
│ 保険者   [      ] 🔍 [                                    ] │
│ 患者ID  [00249707▼] 〜 [         ]   性別 [▼全て]         │
│ 受診コード [  -    ] 🔍 〜 [  -    ]                        │
│                                             [F4: 表示]      │
│ [帳票選択を表示] [個別設定を表示]                            │
├─────────────────────────────────────────────────────────────┤
│ □│受診日  │受診コード│患者ID │受診者│生年月日│性別│コース   │
│ ├─┼────────┼──────────┼───────┼──────┼────────┼────┼─────────┤
│ ☑│2025/12/17│001-0567│00249707│柿本 悟│H04/09/18│男性│会社健診2│
│ ☑│2025/12/17│001-0569│00250886│山田 雄│H09/12/21│男性│会社健診2│
│ □│...                                                       │
├─────────────────────────────────────────────────────────────┤
│ 全てON/OFF  出力形式 [1:プリンタ(印刷)▼]                    │
│ □帳票単位でまとめる  □進捗に反映しない                      │
│ 印刷順 [1:受診日▼]                                         │
│                                                             │
│ 出力帳票:  □事前帳票 □当日帳票 ☑報告書                    │
│ 出力区分:  ☑未出力 ☑出力済 □対象外                        │
│                                                             │
│ ┌─ 帳票出力 ────────────────────────────────────────────┐  │
│ │ ☑ 健診結果票（オプション：ES/CS）                      │  │
│ │ ☑ 人間ドック報告書（当院コース）法人向け              │  │
│ │ ☑ ★健診結果票（オプション）業務あり〜                 │  │
│ │ □ 健診結果票（ベース健診）渋谷駅前                     │  │
│ │ □ ...                                                  │  │
│ └────────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│ [F3:参照][F4:表示][F7:プレビュー][F8:印刷][F9:クリア][F12:終了]│
└─────────────────────────────────────────────────────────────┘
```

### 4.6 進捗一覧画面（SCR-PROG-001）

```
┌─────────────────────────────────────────────────────────────┐
│ 📋 進捗一覧                                                  │
├─────────────────────────────────────────────────────────────┤
│ 受診日     [2025/12/01▼] 〜 [2025/12/20▼]                  │
│ 受診コード [  -    ] 🔍 〜 [  -    ]                        │
│ コース     [      ] 🔍 [                              ]    │
│ 団体       [      ] 🔍 [                              ]    │
│                                                             │
│ 検索対象 [▼全て]  □❤未実施 □💛途中 □💚完了 □自動更新しない │
│                              □進捗を変更する                │
│                                       [検索対象クリア]       │
├─────────────────────────────────────────────────────────────┤
│ │   │受診日  │受診コード│受診者名│事前│受付│当日│問診│身体│検体│画像│特定│判定│所見│報告│請求│個人│
│ │   │        │          │        │帳票│   │帳票│結果│情報│検査│診断│健診│項目│文章│書 │先請│入金│
│ ├───┼────────┼──────────┼────────┼────┼───┼────┼────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
│ │ 1 │12/01   │001-0559 │石川 宏樹│ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │    │
│ │ 2 │12/01   │001-0561 │嶋田 和子│ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │ 💚 │    │
│ │ 3 │12/03   │001-0459 │樋口 智一│ 💛 │ 💚 │ ❤ │ 💛 │ 💚 │ 💚 │ 💚 │ 💛 │ 💛 │ 💛 │ ❤ │ ❤ │    │
│ │ ...                                                       │
├─────────────────────────────────────────────────────────────┤
│ [F1:入力画面へ][F3:参照][F4:表示][F5:登録][F9:クリア][F12:終了]│
└─────────────────────────────────────────────────────────────┘

凡例: ❤=未実施(赤) 💛=途中(オレンジ) 💚=完了(緑)
```

---

## 5. 帳票出力仕様

### 5.1 出力帳票一覧

| 帳票名 | 形式 | 用途 | 優先度 |
|--------|------|------|--------|
| 健診結果報告書 | PDF/Excel | 個人向け結果通知 | ★★★ |
| 特定健診結果報告書 | PDF | 保険者提出用 | ★★★ |
| 健診結果一覧表 | PDF/Excel | 企業向け一覧 | ★★☆ |
| 定期健康診断報告書 | PDF | 労基署提出用 | ★☆☆ |
| 検査項目別異常者一覧 | PDF | 院内管理用 | ★☆☆ |
| 要精密検査一覧 | PDF | フォローアップ用 | ★☆☆ |

### 5.2 結果報告書レイアウト（参照: 特定健診結果報告書PDF）

```
┌─────────────────────────────────────────────────────────────┐
│                    特 定 健 診 結 果 報 告 書                │
├─────────────────────────────────────────────────────────────┤
│ 氏名: [       ] 様  性別: [  ]  年齢: [  ]歳                │
│ 生年月日: [          ]  個人コード: [        ]             │
│ 受診コード: [        ]  受診日: 今回 [    ] 前回 [    ]    │
├─────────────────────────────────────────────────────────────┤
│ 健康診断お疲れ様でした。                                    │
│ 結果をご覧頂き健康の保持・増進にお役立てください。          │
├───────────────────┬───────────────────┬───────────────────┤
│ 検査項目          │ 基準値     │ 今回 │ 前回 │ 前々回 │
├───────────────────┼────────────┼──────┼──────┼────────┤
│ 【身体計測】      │            │      │      │        │
│ 身長        (cm)  │            │167.7 │168.4 │167.8   │
│ 体重        (kg)  │            │ 66.1 │ 63.5 │ 66.8   │
│ 標準体重    (kg)  │            │ 61.9 │ 62.4 │ 61.9   │
│ BMI               │ 25未満     │ 23.5 │ 22.4 │ 23.7   │
│ 腹囲              │ 男:85未満  │ 88.2*│ 84.6 │        │
├───────────────────┼────────────┼──────┼──────┼────────┤
│ 【血圧】          │            │      │      │        │
│ 血圧(最高)        │ 130未満    │ 114  │ 111  │ 120    │
│ 血圧(最低)        │  85未満    │  70  │  76  │  84    │
├───────────────────┼────────────┼──────┼──────┼────────┤
│ 【脂質代謝】      │            │      │      │        │
│ 中性脂肪(TG)      │ 150未満    │  81  │ 106  │  89    │
│ HDL-C             │  40以上    │  57  │  61  │  59    │
│ LDL-C             │ 120未満    │ 142**│ 149**│        │
│ non HDL-C         │ 150未満    │ 177  │ 177  │        │
├───────────────────┴────────────┴──────┴──────┴────────┤
│                                                             │
│ 【総合所見とアドバイス】                                    │
│ ・アセトン体が陽性です。絶食時間が長いと陽性となることが    │
│   あります。経過観察し、嘔気などの自覚症状がある場合は、    │
│   内科を受診してください。                                  │
│ ・総コレステロール・悪玉コレステロール・nonHDLコレステロール│
│   が高値です。食事療法を行い、3ヶ月後に再検してください。   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 判定: A=異常なし B=軽度異常 C=要経過観察 D=要精検 E=要治療  │
│                                                             │
│ 医師名: [         ]            渋谷駅前内科・内視鏡クリニック│
│                                〒150-0002 東京都渋谷区...    │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 既存GASコード活用計画

### 6.1 活用可能モジュール一覧

| 既存ファイル | 主要機能 | 活用方法 | 改修必要度 |
|-------------|---------|----------|-----------|
| `patientManager.js` | 受診者CRUD | そのまま活用 | 低 |
| `portalApi.js` | Web API層 | 拡張して活用 | 中 |
| `CRUD.js` | 汎用CRUD | そのまま活用 | 低 |
| `judgmentEngine.js` | 自動判定 | iD-Heart基準で拡張 | 中 |
| `findingsGenerator.js` | 所見生成 | テンプレート機能追加 | 中 |
| `reportExporter.js` | 帳票出力 | 帳票追加 | 高 |
| `excelExporter.js` | Excel出力 | そのまま活用 | 低 |
| `billingManager.js` | 請求管理 | そのまま活用 | 低 |
| `templateManager.js` | テンプレート | 拡張 | 中 |

### 6.2 新規作成モジュール

| ファイル名 | 機能 | 依存 |
|-----------|------|------|
| `examItemMaster.js` | 検査項目マスタ管理 | CRUD.js |
| `findingMaster.js` | 検査所見マスタ管理 | CRUD.js |
| `resultInput.js` | 結果入力UI連携 | portalApi.js |
| `progressTracker.js` | 進捗管理 | patientManager.js |

### 6.3 portalApi.js 拡張計画

```javascript
// 追加予定API
// 1. 検査項目マスタ関連
function getExamItemMaster(criteria);      // 検査項目マスタ取得
function saveExamItem(itemData);           // 検査項目保存
function getExamItemsByCategory(category); // カテゴリ別取得

// 2. 検査所見マスタ関連
function getFindingMaster(criteria);       // 所見マスタ取得
function saveFinding(findingData);         // 所見保存
function getFindingsByExamItem(itemCode);  // 検査項目別所見取得

// 3. 結果入力関連
function getVisitResults(visitId);         // 受診結果一括取得
function saveVisitResults(visitId, data);  // 受診結果一括保存
function autoJudge(visitId, itemCode);     // 項目別自動判定

// 4. 進捗管理関連
function getProgressList(criteria);        // 進捗一覧取得
function updateProgress(visitId, category); // 進捗更新

// 5. 帳票出力関連
function getReportTemplates();             // 帳票テンプレート一覧
function generateReport(visitId, templateId); // 帳票生成
function batchPrint(visitIds, templateIds); // 一括印刷
```

---

## 7. 実装計画

### 7.1 Phase 1: 基盤構築（1週間）

| タスク | 成果物 | 担当 |
|--------|--------|------|
| データ構造確定 | シート定義書 | - |
| マスタデータ移行 | M_検査項目, M_検査所見 | - |
| 既存コード整理 | リファクタリング済コード | - |

### 7.2 Phase 2: コア機能（2週間）

| タスク | 成果物 | 依存 |
|--------|--------|------|
| 受診者検索画面 | SCR-SRCH-001 | Phase 1 |
| 結果入力画面 | SCR-INPUT-001 | Phase 1 |
| 所見入力（テンプレート） | SCR-FIND-001 | Phase 1 |
| 自動判定機能 | judgmentEngine拡張 | Phase 1 |

### 7.3 Phase 3: 帳票・出力（1週間）

| タスク | 成果物 | 依存 |
|--------|--------|------|
| 帳票印刷画面 | SCR-REPORT-001 | Phase 2 |
| 結果報告書PDF | 帳票テンプレート | Phase 2 |
| Excel出力 | 一覧表出力 | Phase 2 |

### 7.4 Phase 4: 管理機能（1週間）

| タスク | 成果物 | 依存 |
|--------|--------|------|
| 進捗一覧画面 | SCR-PROG-001 | Phase 2 |
| マスタ管理画面 | マスタメンテナンス | Phase 1 |

---

## 8. Git運用方針

### 8.1 ブランチ戦略

```
main (本番)
  │
  ├── develop (開発統合)
  │     │
  │     ├── feature/patient-search (受診者検索)
  │     ├── feature/result-input (結果入力)
  │     ├── feature/findings-template (所見テンプレート)
  │     └── feature/report-output (帳票出力)
  │
  └── hotfix/* (緊急修正)
```

### 8.2 コミットルール

```bash
# 形式: <type>(<scope>): <subject>
# 例:
feat(patient): 受診者検索機能追加
fix(judgment): BMI判定基準修正
refactor(api): portalApi整理
docs(spec): 設計書更新
```

### 8.3 clasp運用

```bash
# 開発フロー
git checkout -b feature/xxx
# ... コード編集 ...
git add .
git commit -m "feat(xxx): 機能追加"
clasp push
# 開発URLでテスト
# OK後
git push origin feature/xxx
# PRマージ後
clasp deploy --description "v1.x.x - 機能追加"
```

---

## 9. 付録

### A. iD-Heart検査項目コード体系

| コード範囲 | カテゴリ | 例 |
|-----------|---------|-----|
| 011xxx | 身体計測 | 011001=身長, 011002=体重 |
| 012xxx | 生理検査 | 012003=心電図, 012012=胸部X線 |
| 021xxx | 血液検査 | 021018=総コレステロール |
| 023xxx | 尿検査 | 023024=尿蛋白 |
| 014xxx | 画像診断 | 014003=心エコー |

### B. 判定コード

| コード | 判定 | 説明 |
|--------|------|------|
| A | 異常なし | 基準値内 |
| B | 軽度異常 | 経過観察不要 |
| C | 要経過観察 | 定期的なフォロー |
| D | 要治療 | 治療開始推奨 |
| E | 要精検 | 精密検査必要 |
| F | 治療中 | 現在治療中 |

### C. 参考資料

- iD-Heart II スクリーンショット（115ファイル）
- 帳票サンプルPDF（結果報告書、一覧表等）
- 既存GASコード一覧

---

**作成者**: Claude AI
**レビュー**: 要レビュー
**次回更新**: 実装開始時
